<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- External CSS -->
    <link rel="stylesheet" href="/styles/cart.css">

    <!-- FontAwesome for icons -->
    <script src="https://kit.fontawesome.com/9d9796826b.js" crossorigin="anonymous"></script>
</head>
<body>

<!-- Shopping Cart Section -->
<section class="container mt-5" id="shopping-cart">
    <h3 class="text-center mb-5" style="text-decoration: underline;">Shopping Cart</h3>

    <!-- Table for Cart Items -->
    <table class="table table-hover table-cart">
        <thead>
            <tr>
                <th>Item</th>
                <th>Price</th>
                <th>Quantity</th>
            </tr>
        </thead>
        <tbody class="cart-items">
            <!-- Example Item Row -->
            <tr>
                <td class="d-flex align-items-center">
                    <img src="card-image.jpg" alt="Card Image" class="img-thumbnail" width="100" height="100">
                    <span class="ms-3">Personalized Birthday Card</span>
                </td>
                <td>₪ 50.00</td>
                <td>
                    <button class="btn btn-secondary add-button" aria-label="Add another item">
                        <span class="plus-icon">+</span>
                    </button>
                    <button class="btn btn-danger ms-2">Remove</button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Cart Summary -->
    <div class="card mt-5">
        <div class="card-body">
            <h5>Cart Summary</h5>
            <p><strong>Items Total:</strong> ₪ <span id="items-total">50.00</span></p>

            <!-- Address Form -->
            <h5 class="mt-4">Shipping Address</h5>
            <form id="address-form" class="mt-3">
                <div class="mb-3">
                    <input type="text" id="street" name="street" class="form-control" placeholder="Street" required>
                </div>
                <div class="mb-3">
                    <input type="text" id="locality" name="locality" class="form-control" placeholder="City" required>
                </div>
                <div class="mb-3">
                    <input type="text" id="postal_code" name="postal_code" placeholder="Enter postal code" pattern="[0-9]*" title="Postal code must be a number" required>
                </div>
                <input type="hidden" id="country" name="country" value="ISR"> <!-- Hidden field for Israel -->
                <button type="submit" class="btn btn-primary">Validate Address</button>
            </form>

            <!-- Validation Message -->
            <div id="validation-message" class="mt-3"></div>
        </div>
    </div>
</section>

<script>
    // Send the address data to the backend for validation
    document.getElementById('address-form').addEventListener('submit', async function(event) {
        event.preventDefault(); // Prevent form from submitting the default way

        // Collect address data from the form
        const street = document.getElementById('street').value.trim();
        const locality = document.getElementById('locality').value.trim();
        const postal_code = document.getElementById('postal_code').value.trim();

        const messageElement = document.getElementById('validation-message');
        messageElement.textContent = ''; // Clear any previous validation messages

        // Client-side validation to ensure all fields are filled
        if (!street || !locality || !postal_code) {
            messageElement.textContent = 'Please fill in all the required fields.';
            messageElement.style.color = 'red';
            return;
        }

        try {
            // Send the data to the server
            const response = await fetch('/cart/validate-address', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ street, locality, postal_code, country: 'ISR' })
            });

            const result = await response.json();

            // Display the validation result based on the backend response
            if (result.valid) {
                messageElement.textContent = result.message;
                messageElement.style.color = 'green';
            } else {
                messageElement.textContent = 'Validation failed: ' + result.message;
                messageElement.style.color = 'red';
            }
        } catch (error) {
            // Handle unexpected network or server errors
            console.error('Error during address validation:', error);
            messageElement.textContent = 'Error occurred while validating the address. Please contact the store.';
            messageElement.style.color = 'red';
        }
    });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- External JS -->
<script src="/js/cart.js"></script>

</body>
</html>
